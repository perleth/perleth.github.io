"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),debounce=function t(e,i,s){var n;return function(){var t=this,a=arguments,r=function l(){n=null,s||e.apply(t,a)},h=s&&!n;clearTimeout(n),n=setTimeout(r,i),h&&e.apply(t,a)}},Slideshow=function(){function t(e){_classCallCheck(this,t),this.DOM={},this.DOM.el=e,this.settings={animation:{slides:{duration:600,easing:"easeOutQuint"},shape:{duration:300,easing:{"in":"easeOutQuad",out:"easeOutQuad"}}},frameFill:"#111"},this.init()}return _createClass(t,[{key:"init",value:function e(){this.DOM.slides=Array.from(this.DOM.el.querySelectorAll(".slides > .slide")),this.slidesTotal=this.DOM.slides.length,this.DOM.nav=this.DOM.el.querySelector(".slide-nav"),this.DOM.nextCtrl=this.DOM.nav.querySelector(".next"),this.DOM.prevCtrl=this.DOM.nav.querySelector(".prev"),this.current=0,this.createFrame(),this.initEvents()}},{key:"createFrame",value:function i(){this.rect=this.DOM.el.getBoundingClientRect(),this.frameSize=this.rect.width/12,this.paths={initial:this.calculatePath("initial"),"final":this.calculatePath("final")},this.DOM.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.DOM.svg.setAttribute("class","shape"),this.DOM.svg.setAttribute("width","100%"),this.DOM.svg.setAttribute("height","100%"),this.DOM.svg.setAttribute("viewbox","0 0 "+this.rect.width+" "+this.rect.height),this.DOM.svg.innerHTML='<path fill="'+this.settings.frameFill+'" d="'+this.paths.initial+'"/>',this.DOM.el.insertBefore(this.DOM.svg,this.DOM.nav),this.DOM.shape=this.DOM.svg.lastElementChild}},{key:"updateFrame",value:function s(){this.paths.initial=this.calculatePath("initial"),this.paths["final"]=this.calculatePath("final"),this.DOM.svg.setAttribute("viewbox","0 0 "+this.rect.width+" "+this.rect.height),this.DOM.shape.setAttribute("d",this.isAnimating?this.paths["final"]:this.paths.initial)}},{key:"calculatePath",value:function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";return"initial"===t?"M 0,0 0,"+this.rect.height+" "+this.rect.width+","+this.rect.height+" "+this.rect.width+",0 0,0 Z M 0,0 "+this.rect.width+",0 "+this.rect.width+","+this.rect.height+" 0,"+this.rect.height+" Z":{next:"M 0,0 0,"+this.rect.height+" "+this.rect.width+","+this.rect.height+" "+this.rect.width+",0 0,0 Z M "+this.frameSize+","+this.frameSize+" "+(this.rect.width-this.frameSize)+","+this.frameSize/2+" "+(this.rect.width-this.frameSize)+","+(this.rect.height-this.frameSize/2)+" "+this.frameSize+","+(this.rect.height-this.frameSize)+" Z",prev:"M 0,0 0,"+this.rect.height+" "+this.rect.width+","+this.rect.height+" "+this.rect.width+",0 0,0 Z M "+this.frameSize+","+this.frameSize/2+" "+(this.rect.width-this.frameSize)+","+this.frameSize+" "+(this.rect.width-this.frameSize)+","+(this.rect.height-this.frameSize)+" "+this.frameSize+","+(this.rect.height-this.frameSize/2)+" Z"}}},{key:"initEvents",value:function a(){var t=this;this.DOM.nextCtrl.addEventListener("click",function(){return t.navigate("next")}),this.DOM.prevCtrl.addEventListener("click",function(){return t.navigate("prev")}),window.addEventListener("resize",debounce(function(){t.rect=t.DOM.el.getBoundingClientRect(),t.updateFrame()},20)),document.addEventListener("keydown",function(e){var i=e.keyCode||e.which;37===i?t.navigate("prev"):39===i&&t.navigate("next")})}},{key:"navigate",value:function r(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"next";if(this.isAnimating)return!1;this.isAnimating=!0;var i=anime({targets:this.DOM.shape,duration:this.settings.animation.shape.duration,easing:this.settings.animation.shape.easing["in"],d:"next"===e?this.paths["final"].next:this.paths["final"].prev}),s=function a(){return new Promise(function(i,s){var n=t.DOM.slides[t.current];anime({targets:n,duration:t.settings.animation.slides.duration,easing:t.settings.animation.slides.easing,translateX:"next"===e?-1*t.rect.width:t.rect.width,complete:function l(){n.classList.remove("slide--current"),i()}}),t.current="next"===e?t.current<t.slidesTotal-1?t.current+1:0:t.current>0?t.current-1:t.slidesTotal-1;var a=t.DOM.slides[t.current];a.classList.add("slide--current"),anime({targets:a,duration:t.settings.animation.slides.duration,easing:t.settings.animation.slides.easing,translateX:["next"===e?t.rect.width:-1*t.rect.width,0]});var r=a.querySelector(".slide__img");r.style.transformOrigin="next"===e?"-10% 50%":"110% 50%",anime.remove(r),anime({targets:r,duration:4*t.settings.animation.slides.duration,easing:"easeOutElastic",elasticity:350,scale:[1.2,1],rotate:["next"===e?4:-4,0]});var h=a.querySelector(".gradient-color");h.style.transformOrigin="next"===e?"-10% 50%":"110% 50%",anime.remove(h),anime({targets:h,duration:4*t.settings.animation.slides.duration,easing:"easeOutElastic",elasticity:350,scale:[1.2,1],rotate:["next"===e?4:-4,0]}),anime({targets:[a.querySelector(".slide__title"),a.querySelector(".slide__desc"),a.querySelector(".slide__link"),a.querySelector(".slide__small__image")],duration:t.settings.animation.slides.duration,easing:t.settings.animation.slides.easing,delay:function c(t,i,s){return"next"===e?100*i+750:100*(s-i-1)+750},translateY:["next"===e?300:-300,0],rotate:[15,0],opacity:[0,1]})})},n=function r(){anime({targets:t.DOM.shape,duration:t.settings.animation.shape.duration,delay:150,easing:t.settings.animation.shape.easing.out,d:t.paths.initial,complete:function e(){return t.isAnimating=!1}})};i.finished.then(s).then(n)}}]),t}();new Slideshow(document.querySelector(".slideshow"));